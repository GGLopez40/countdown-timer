function HSVtoRGB(t,e,i){var s,r,n,o,a,l,h,c;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),i/=100,0==(e/=100))return s=r=n=i,[Math.round(255*s),Math.round(255*r),Math.round(255*n)];switch(l=i*(1-e),h=i*(1-e*(a=(t/=60)-(o=Math.floor(t)))),c=i*(1-e*(1-a)),o){case 0:s=i,r=c,n=l;break;case 1:s=h,r=i,n=l;break;case 2:s=l,r=i,n=c;break;case 3:s=l,r=h,n=i;break;case 4:s=c,r=l,n=i;break;default:s=i,r=l,n=h}return[Math.round(255*s),Math.round(255*r),Math.round(255*n)]}function RGBtoHSV(t,e,i){1===arguments.length&&(e=t.g,i=t.b,t=t.r);var s,r=Math.max(t,e,i),n=Math.min(t,e,i),o=r-n,a=0===r?0:o/r,l=r/255;switch(r){case n:s=0;break;case t:s=e-i+o*(e<i?6:0),s/=6*o;break;case e:s=i-t+2*o,s/=6*o;break;case i:s=t-e+4*o,s/=6*o}return{h:s,s:a,v:l}}var CLIENT_ID="240364897736-l92t1hd17n06hen63b130f9pju5fvk0e.apps.googleusercontent.com",API_KEY="AIzaSyAtM_vRxZXAA4U1hfkSUxWGBwiXFhb5tUU",DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],SCOPES="https://www.googleapis.com/auth/calendar.readonly";function loadedPage(){gapi.load("client:auth2",app.initClient)}let app=new Vue({el:"#app",data:{user:null,stops:[],currStop:0,gapPrior:!1,currTime:new Date,start:null,end:null,lastend:null,switch:!1,error:null,firstCircle:0,secondCircle:0,windowMin:0,countup:0,setup:!1,saved:!1,colorTimer:!0,colorIndex:0,color:"rgb(247, 87, 87)",colors:[{color:"rgb(71,92,122)",index:0},{color:"rgb(247, 177, 91)",index:1},{color:"rgb(87, 162, 247)",index:2},{color:"rgb(40,40,40)",index:3},{color:"rgb(166,32,106)",index:4},{color:"rgb(86,142,166)",index:5},{color:"rgb(216,115,127)",index:6},{color:"rgb(243,111,56)",index:7},{color:"RGB(60, 179, 113)",index:8},{color:"RGB(30, 144, 255)",index:9},{color:"RGB(75, 0, 130)",index:10},{color:"RGB(128, 0, 0)",index:11},{color:"RGB(25, 25, 112)",index:12},{color:"RGB(112, 128, 144)",index:13}]},methods:{saveColor(){this.saved=!0,document.cookie="color = "+this.colorIndex+"; path=/",console.log("Preferences Saved")},signIn(){gapi.auth2.getAuthInstance().signIn(),this.initClient()},signOut(){gapi.auth2.getAuthInstance().signOut()},chooseColor(t){this.saved=!1,this.colorIndex=t,t>=0&&t<=this.colors.length-1&&(this.color=this.colors[this.colorIndex].color)},async initClient(){try{await gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen()},function(t){this.error=JSON.stringify(t,null,2)})}catch(t){console.log(t)}this.user="Loading",this.setup=!0,await this.listUpcomingEvents(),setInterval(this.count,100)},async lastEventEnd(){let t=new Date(this.currTime.setHours(0,0,0,0)),e=new Date(t.getTime()+864e5);return new Date((await this.findLastEvent(0,t,e)).end.dateTime).getTime()},async findLastEvent(t,e,i){let s=await gapi.client.calendar.events.list({calendarId:"primary",timeMin:e.toISOString(),timeMax:i.toISOString(),showDeleted:!1,singleEvents:!0,maxResults:100,orderBy:"startTime"}),r=null;for(var n=0;n<s.result.items.length;n++)if("date"!=Object.keys(s.result.items[n].start)[0]){if(new Date(s.result.items[n].start.dateTime).getTime()>this.currTime.getTime()&&null!=r)return s.result.items[r];if(new Date(s.result.items[n].end.dateTime).getTime()<this.currTime.getTime()&&n==s.result.items.length-1)return s.result.items[n];r=n}return this.findLastEvent(t+1,new Date(e.getTime()-864e5*(t+1)),e)},async listUpcomingEvents(){if(this.setup){let e=await gapi.client.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"});this.user=e.result.items[0].creator.email;let i=[];for(var t=0;t<e.result.items.length;t++){if(null==e.result.items[t].start.dateTime)continue;let s={title:e.result.items[t].summary,start:new Date(e.result.items[t].start.dateTime),end:new Date(e.result.items[t].end.dateTime)};i.push(s)}this.stops=i,this.lastEnd=await this.lastEventEnd()}},async count(){this.currTime=new Date,await this.windowSize(),this.switch=!0},updateCircle(){let t=this.start,e=this.end-t,i=(this.currTime.getTime()-t)/e,s=360*i,r=0;if(s>180&&(s=180,r=360*i-180),this.firstCircle=s,this.secondCircle=r,-1==this.colorIndex){if(i>=0&&i<=1){let t=HSVtoRGB(115*(1-i),100,73);this.color="rgb("+t[0]+","+t[1]+","+t[2]+")"}}else this.color=this.colors[this.colorIndex].color},async updateStop(){if(0!=this.stops.length&&(this.end<this.currTime.getTime()||null==this.start)){for(;this.stops[this.currStop].end.getTime()<this.currTime.getTime();)this.currStop+=1,this.currStop>this.stops.length-1&&(await this.listUpcomingEvents(),this.currStop=0);this.stops[this.currStop].start.getTime()>this.currTime.getTime()?(this.gapPrior=!0,0==this.currStop?this.lastEnd=await this.lastEventEnd():this.lastEnd=this.stops[this.currStop-1].end.getTime(),this.start=this.lastEnd,this.end=this.stops[this.currStop].start.getTime()):(this.gapPrior=!1,this.start=this.stops[this.currStop].start.getTime(),this.end=this.stops[this.currStop].end.getTime())}},toString(t){let e="";for(let i=0;i<t.length;i++)"hours"==t[i].type||"hour"==t[i].type?(e+=t[i].num,i!=t.length-1?e+=":":e+=":00"):"minutes"==t[i].type||"minute"==t[i].type?(t[i].num<10&&(e+="0"),e+=t[i].num,i!=t.length-1?e+=":":e+=":00"):"seconds"==t[i].type||"second"==t[i].type?(t[i].num<10&&(e+="0"),e+=t[i].num):e+=t[i].num+" "+t[i].type+" ";document.title=e},windowSize(){this.windowMin=window.innerHeight,window.innerWidth<this.windowMin&&(this.windowMin=window.innerWidth)},scroll(t){t?window.scroll({top:window.innerHeight,left:0,behavior:"smooth"}):window.scroll({top:0,left:0,behavior:"smooth"})}},computed:{remaining(){if(1==this.switch&&(this.switch=!1),0==this.stops.length)return;let t=[],e=this.end-this.currTime.getTime(),i=Math.floor(e/31536e6),s=Math.floor(e/26784e5)%12,r=Math.floor(e/864e5)%31,n=Math.floor(e/36e5)%24,o=Math.floor(e/6e4)%60,a=Math.floor(e/1e3)%60;if(i>0){let e="";i>1&&(e="s"),t.push({num:i,type:"year"+e})}if(s>0){let e="";s>1&&(e="s"),t.push({num:s,type:"month"+e})}if(r>0){let e="";r>1&&(e="s"),t.push({num:r,type:"day"+e})}if(n>0){let e="";n>1&&(e="s"),t.push({num:n,type:"hour"+e})}if(o>0){let e="";o>1&&(e="s"),t.push({num:o,type:"minute"+e})}if(a>0){let e="";a>1&&(e="s"),t.push({num:a,type:"second"+e})}return 0==t.length&&(this.updateStop(),t=[{num:0,type:"seconds"}]),this.updateCircle(),this.toString(t),t},colorLight(){return this.color.substring(0,3)+"a"+this.color.substring(3,this.color.length-4)+", .2)"},savedText(){return this.saved?"Saved":"Save Preference"}},created(){this.initClient();var t=document.cookie;"color"==t.substring(16,21)&&(this.saved=!0,this.colorIndex=parseInt(t.substring(22),10),-1==this.colorIndex?this.colorTimer=!0:this.colorTimer=!1,console.log("Preferences Loaded"))}})